<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - KCT Placement</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        primary: { 50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc', 400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 800: '#3730a3', 900: '#312e81' },
                        slate: { 850: '#151e32', 900: '#0f172a' }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        /* Sidebar Nav Active State */
        .nav-item.active {
            background-color: #eff6ff;
            color: #4f46e5;
            border-right: 3px solid #4f46e5;
        }

        .nav-item {
            border-right: 3px solid transparent;
        }

        /* Form Inputs */
        .input-group label {
            display: block;
            font-size: 0.75rem;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 0.35rem;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 0.625rem 0.875rem;
            background-color: #fff;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            color: #1e293b;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #6366f1;
            ring: 2px solid #e0e7ff;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .input-group input::placeholder,
        .input-group textarea::placeholder {
            color: #94a3b8;
        }
    </style>
</head>

<body class="text-slate-800 antialiased bg-[#f8fafc]">
    <!-- Loading Overlay -->
    <div id="loading-overlay"
        class="fixed inset-0 z-50 flex items-center justify-center bg-white/90 backdrop-blur-sm transition-opacity duration-300">
        <div class="flex flex-col items-center">
            <div class="w-10 h-10 border-3 border-primary-600 border-t-transparent rounded-full animate-spin mb-3">
            </div>
            <p class="text-sm font-medium text-slate-500 animate-pulse">Loading Profile...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-30 h-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-full flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div
                    class="w-8 h-8 rounded-lg bg-gradient-to-br from-primary-600 to-indigo-700 flex items-center justify-center text-white shadow-md shadow-primary-500/20">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                </div>
                <span class="text-lg font-bold text-slate-800 tracking-tight">KCT Placement <span
                        class="text-slate-400 font-normal">Portal</span></span>
            </div>
            <div class="flex items-center gap-4">
                <div
                    class="hidden sm:flex items-center gap-3 bg-slate-50 px-3 py-1.5 rounded-full border border-slate-100">
                    <img id="header-avatar" src="" class="w-7 h-7 rounded-full object-cover ring-2 ring-white">
                    <div class="text-right">
                        <p id="header-name" class="text-xs font-bold text-slate-700 leading-none">Student</p>
                        <p id="header-roll" class="text-[10px] text-slate-400 font-mono leading-none mt-0.5">...</p>
                    </div>
                </div>
                <button onclick="logout()"
                    class="p-2 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors"
                    title="Sign Out">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 flex items-start gap-8">

        <!-- Sidebar Navigation -->
        <aside class="w-64 hidden lg:block flex-shrink-0 sticky top-24">
            <!-- Profile Snapshot -->
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 text-center mb-6">
                <div class="relative inline-block mb-3 group">
                    <img id="profile-avatar" src=""
                        class="w-20 h-20 rounded-full object-cover ring-4 ring-slate-50 mx-auto">
                    <label
                        class="absolute bottom-0 right-0 bg-white rounded-full p-1.5 shadow-md border border-slate-100 cursor-pointer hover:text-primary-600 text-slate-400 transition-colors">
                        <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                        </svg>
                        <input type="file" id="photo-input" accept="image/*" class="hidden"
                            onchange="uploadPhoto(this)">
                    </label>
                </div>
                <h2 id="profile-name" class="font-bold text-slate-800 text-lg leading-tight">...</h2>
                <p id="profile-email" class="text-xs text-slate-500 mb-4 mt-1">...</p>

                <div class="flex items-center justify-center gap-2 mb-4">
                    <span id="badge-status"
                        class="px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide bg-slate-100 text-slate-600">Status</span>
                    <span id="badge-batch"
                        class="px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide bg-indigo-50 text-indigo-600">Batch</span>
                </div>

                <!-- Progress -->
                <div class="bg-slate-50 rounded-lg p-3">
                    <div class="flex justify-between text-xs mb-1.5">
                        <span class="text-slate-500 font-medium">Profile Completion</span>
                        <span id="progress-percent" class="text-primary-600 font-bold">0%</span>
                    </div>
                    <div class="h-1.5 bg-slate-200 rounded-full overflow-hidden">
                        <div id="progress-bar" class="h-full bg-primary-500 rounded-full transition-all duration-500"
                            style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Navigation Menu -->
            <nav class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <button onclick="showTab('personal')" data-tab="personal"
                    class="nav-item w-full flex items-center gap-3 px-5 py-3.5 text-sm font-medium text-slate-600 hover:bg-slate-50 transition-colors active">
                    <svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                    Personal Info
                </button>
                <button onclick="showTab('academics')" data-tab="academics"
                    class="nav-item w-full flex items-center gap-3 px-5 py-3.5 text-sm font-medium text-slate-600 hover:bg-slate-50 transition-colors">
                    <svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 14l9-5-9-5-9 5 9 5z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" />
                    </svg>
                    Academics
                </button>
                <button onclick="showTab('skills')" data-tab="skills"
                    class="nav-item w-full flex items-center gap-3 px-5 py-3.5 text-sm font-medium text-slate-600 hover:bg-slate-50 transition-colors">
                    <svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                    </svg>
                    Skills
                </button>
                <button onclick="showTab('achievements')" data-tab="achievements"
                    class="nav-item w-full flex items-center gap-3 px-5 py-3.5 text-sm font-medium text-slate-600 hover:bg-slate-50 transition-colors">
                    <svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Achievements
                </button>
                <button onclick="showTab('family')" data-tab="family"
                    class="nav-item w-full flex items-center gap-3 px-5 py-3.5 text-sm font-medium text-slate-600 hover:bg-slate-50 transition-colors">
                    <svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    Family
                </button>
                <button onclick="showTab('career')" data-tab="career"
                    class="nav-item w-full flex items-center gap-3 px-5 py-3.5 text-sm font-medium text-slate-600 hover:bg-slate-50 transition-colors">
                    <svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                    </svg>
                    Career Goals
                </button>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <div class="flex-1 min-w-0">
            <!-- Mobile Nav (Horizontal Scroll) -->
            <div class="lg:hidden mb-6 overflow-x-auto pb-2 scrollbar-none flex gap-2">
                <!-- Populated via JS/CSS logic if needed, or simply hide sidebar on mobile and show drawer/dropdown. For now, simple horizontal scroll buttons -->
                <button onclick="showTab('personal')"
                    class="mobile-tab px-4 py-2 bg-white rounded-lg border border-slate-200 text-sm whitespace-nowrap active-tab:bg-primary-50 active-tab:border-primary-200 active-tab:text-primary-600">Personal</button>
                <button onclick="showTab('academics')"
                    class="mobile-tab px-4 py-2 bg-white rounded-lg border border-slate-200 text-sm whitespace-nowrap">Academics</button>
                <button onclick="showTab('skills')"
                    class="mobile-tab px-4 py-2 bg-white rounded-lg border border-slate-200 text-sm whitespace-nowrap">Skills</button>
                <button onclick="showTab('achievements')"
                    class="mobile-tab px-4 py-2 bg-white rounded-lg border border-slate-200 text-sm whitespace-nowrap">Achievements</button>
                <button onclick="showTab('family')"
                    class="mobile-tab px-4 py-2 bg-white rounded-lg border border-slate-200 text-sm whitespace-nowrap">Family</button>
                <button onclick="showTab('career')"
                    class="mobile-tab px-4 py-2 bg-white rounded-lg border border-slate-200 text-sm whitespace-nowrap">Career</button>
            </div>

            <!-- CONTENT SECTIONS -->
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 min-h-[600px] relative">

                <!-- Personal Info -->
                <div id="tab-personal" class="tab-content p-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-slate-800">Personal Details</h2>
                        <span class="text-xs text-slate-400 font-mono">ID: <span id="display-roll">---</span></span>
                    </div>
                    <form id="form-personal" onsubmit="saveSection(event, 'personal')"
                        class="grid sm:grid-cols-2 gap-x-6 gap-y-5">
                        <div class="input-group">
                            <label>Full Name *</label>
                            <input type="text" name="name" required placeholder="John Doe">
                        </div>
                        <div class="input-group">
                            <label>Roll Number *</label>
                            <input type="text" name="roll_no" required placeholder="Ex: 22CSR001" class="uppercase">
                        </div>
                        <div class="input-group">
                            <label>Official Email</label>
                            <input type="email" name="email" disabled
                                class="bg-slate-50 text-slate-500 cursor-not-allowed">
                        </div>
                        <div class="input-group">
                            <label>Personal Email</label>
                            <input type="email" name="personal_email" placeholder="john.doe@gmail.com">
                        </div>
                        <div class="input-group">
                            <label>Mobile Number *</label>
                            <input type="tel" name="mobile_number" required pattern="[0-9]{10}"
                                placeholder="9876543210">
                        </div>
                        <div class="input-group">
                            <label>Alternate Mobile</label>
                            <input type="tel" name="alt_mobile_number" pattern="[0-9]{10}"
                                placeholder="Parent/Guardian Phone">
                        </div>
                        <div class="input-group">
                            <label>Date of Birth</label>
                            <input type="date" name="date_of_birth">
                        </div>
                        <div class="input-group">
                            <label>Gender</label>
                            <select name="gender">
                                <option value="">Select</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Batch Year</label>
                            <select name="batch_year" id="select-batch">
                                <option value="">Select Batch</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Aadhaar Number</label>
                            <input type="text" name="aadhaar_no" pattern="[0-9]{12}" placeholder="12 Digit UID">
                        </div>

                        <div class="sm:col-span-2 border-t border-slate-100 my-2 pt-4">
                            <h3 class="text-sm font-bold text-slate-800">Online Prosence</h3>
                        </div>

                        <div class="input-group">
                            <label>LinkedIn URL</label>
                            <input type="url" name="linkedin_url" placeholder="https://linkedin.com/in/...">
                        </div>
                        <div class="input-group">
                            <label>GitHub URL</label>
                            <input type="url" name="github_url" placeholder="https://github.com/...">
                        </div>
                        <div class="input-group sm:col-span-2">
                            <label>Portfolio / Website</label>
                            <input type="url" name="portfolio_url" placeholder="https://...">
                        </div>

                        <div class="sm:col-span-2 border-t border-slate-100 my-2 pt-4">
                            <h3 class="text-sm font-bold text-slate-800">Address</h3>
                        </div>

                        <div class="input-group sm:col-span-2">
                            <label>Permanent Address</label>
                            <textarea name="address" rows="3" placeholder="Street, Area, Landmark..."></textarea>
                        </div>
                        <div class="input-group">
                            <label>City</label>
                            <input type="text" name="city">
                        </div>
                        <div class="input-group">
                            <label>Pincode</label>
                            <input type="text" name="pincode" pattern="[0-9]{6}">
                        </div>
                        <div class="input-group">
                            <label>Residence Type</label>
                            <select name="residence_type">
                                <option value="">Select</option>
                                <option value="day_scholar">Day Scholar</option>
                                <option value="hosteler">Hosteller</option>
                            </select>
                        </div>

                        <div class="sm:col-span-2 pt-6 flex justify-end">
                            <button type="submit"
                                class="bg-primary-600 text-white px-6 py-2.5 rounded-lg font-medium hover:bg-primary-700 transition shadow-lg shadow-primary-500/30">Save
                                Personal Info</button>
                        </div>
                    </form>
                </div>

                <!-- Academics -->
                <div id="tab-academics" class="tab-content p-8 hidden">
                    <h2 class="text-2xl font-bold text-slate-800 mb-6">Academic Performance</h2>
                    <form id="form-academics" onsubmit="saveSection(event, 'academics')" class="space-y-8">

                        <!-- Schooling -->
                        <div>
                            <h3
                                class="text-sm font-bold text-slate-500 uppercase tracking-wide mb-4 border-b border-slate-100 pb-2">
                                Schooling</h3>
                            <div class="grid sm:grid-cols-3 gap-5 bg-slate-50 p-5 rounded-xl border border-slate-100">
                                <div class="col-span-3 sm:col-span-1">
                                    <h4 class="font-bold text-slate-700">10th Standard</h4>
                                </div>
                                <div class="input-group"><label>Board</label><select name="tenth_board">
                                        <option value="CBSE">CBSE</option>
                                        <option value="State Board">State Board</option>
                                        <option value="ICSE">ICSE</option>
                                        <option value="Other">Other</option>
                                    </select></div>
                                <div class="input-group"><label>Percentage %</label><input type="number" step="0.01"
                                        max="100" name="tenth_percentage"></div>
                                <div class="input-group sm:col-start-2"><label>Year of Passing</label><input
                                        type="number" name="tenth_year"></div>
                            </div>
                            <div
                                class="grid sm:grid-cols-3 gap-5 bg-slate-50 p-5 rounded-xl border border-slate-100 mt-4">
                                <div class="col-span-3 sm:col-span-1">
                                    <h4 class="font-bold text-slate-700">12th / Diploma</h4>
                                </div>
                                <div class="input-group"><label>Stream</label><select name="twelfth_board">
                                        <option value="CBSE">CBSE</option>
                                        <option value="State Board">State Board</option>
                                        <option value="Diploma">Diploma</option>
                                        <option value="Other">Other</option>
                                    </select></div>
                                <div class="input-group"><label>Percentage %</label><input type="number" step="0.01"
                                        max="100" name="twelfth_percentage"></div>
                                <div class="input-group sm:col-start-2"><label>Year of Passing</label><input
                                        type="number" name="twelfth_year"></div>
                            </div>
                        </div>

                        <!-- College -->
                        <div>
                            <h3
                                class="text-sm font-bold text-slate-500 uppercase tracking-wide mb-4 border-b border-slate-100 pb-2">
                                College CGPA</h3>
                            <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                                <div class="input-group"><label>Sem 1</label><input type="number" step="0.01" max="10"
                                        name="cgpa_sem1"></div>
                                <div class="input-group"><label>Sem 2</label><input type="number" step="0.01" max="10"
                                        name="cgpa_sem2"></div>
                                <div class="input-group"><label>Sem 3</label><input type="number" step="0.01" max="10"
                                        name="cgpa_sem3"></div>
                                <div class="input-group"><label>Sem 4</label><input type="number" step="0.01" max="10"
                                        name="cgpa_sem4"></div>
                                <div class="input-group"><label>Sem 5</label><input type="number" step="0.01" max="10"
                                        name="cgpa_sem5"></div>
                                <div class="input-group"><label>Sem 6</label><input type="number" step="0.01" max="10"
                                        name="cgpa_sem6"></div>
                                <div class="input-group"><label>Sem 7</label><input type="number" step="0.01" max="10"
                                        name="cgpa_sem7"></div>
                                <div class="input-group"><label>Sem 8</label><input type="number" step="0.01" max="10"
                                        name="cgpa_sem8"></div>
                            </div>
                            <div
                                class="grid sm:grid-cols-3 gap-6 mt-6 p-5 bg-indigo-50 rounded-xl border border-indigo-100">
                                <div class="input-group">
                                    <label class="text-indigo-800">Overall CGPA *</label>
                                    <input type="number" step="0.01" max="10" name="cgpa_overall" required
                                        class="font-bold text-lg">
                                </div>
                                <div class="input-group">
                                    <label class="text-indigo-800">Active Backlogs</label>
                                    <input type="number" name="current_backlogs" value="0">
                                </div>
                                <div class="input-group">
                                    <label class="text-indigo-800">History of Arrears</label>
                                    <select name="has_backlog_history">
                                        <option value="false">No</option>
                                        <option value="true">Yes</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="pt-2 flex justify-end">
                            <button type="submit"
                                class="bg-primary-600 text-white px-6 py-2.5 rounded-lg font-medium hover:bg-primary-700 transition shadow-lg shadow-primary-500/30">Save
                                Academics</button>
                        </div>
                    </form>
                </div>

                <!-- Achievements -->
                <div id="tab-achievements" class="tab-content p-8 hidden">
                    <h2 class="text-2xl font-bold text-slate-800 mb-6">Achievements</h2>
                    <form id="form-achievements" onsubmit="saveSection(event, 'achievements')" class="space-y-6">
                        <div class="input-group">
                            <label>Certifications</label>
                            <textarea name="certifications" rows="3"
                                placeholder="AWS Certified Cloud Practitioner, Google Data Analytics..."></textarea>
                        </div>
                        <div class="input-group">
                            <label>Internships</label>
                            <textarea name="internships" rows="3"
                                placeholder="Software Intern at XYZ Corp (2 months)..."></textarea>
                        </div>
                        <div class="input-group">
                            <label>Projects</label>
                            <textarea name="projects" rows="3"
                                placeholder="Inventory System using MERN Stack..."></textarea>
                        </div>
                        <div class="input-group">
                            <label>Workshops / Training</label>
                            <textarea name="workshops" rows="2"
                                placeholder="AI/ML Workshop by IIT Madras..."></textarea>
                        </div>
                        <div class="input-group">
                            <label>Extracurriculars</label>
                            <textarea name="extra_curriculars" rows="2"
                                placeholder="College Football Team Captain, Debate Club Member..."></textarea>
                        </div>
                        <div class="input-group">
                            <label>Awards</label>
                            <textarea name="awards" rows="2" placeholder="1st Prize in Hackathon 2024..."></textarea>
                        </div>

                        <div class="pt-2 flex justify-end">
                            <button type="submit"
                                class="bg-primary-600 text-white px-6 py-2.5 rounded-lg font-medium hover:bg-primary-700 transition shadow-lg shadow-primary-500/30">Save
                                Achievements</button>
                        </div>
                    </form>
                </div>

                <!-- Family -->
                <div id="tab-family" class="tab-content p-8 hidden">
                    <h2 class="text-2xl font-bold text-slate-800 mb-6">Family Background</h2>
                    <form id="form-family" onsubmit="saveSection(event, 'family')" class="space-y-8">
                        <div class="grid sm:grid-cols-2 gap-6 p-5 bg-slate-50 rounded-xl border border-slate-100">
                            <h3 class="sm:col-span-2 text-sm font-bold text-slate-500 uppercase tracking-wide">Father's
                                Details</h3>
                            <div class="input-group"><label>Name</label><input type="text" name="father_name"></div>
                            <div class="input-group"><label>Mobile</label><input type="tel" name="father_mobile"></div>
                            <div class="input-group"><label>Occupation</label><input type="text"
                                    name="father_occupation"></div>
                            <div class="input-group"><label>Company/Work</label><input type="text"
                                    name="father_company_details"></div>
                        </div>

                        <div class="grid sm:grid-cols-2 gap-6 p-5 bg-slate-50 rounded-xl border border-slate-100">
                            <h3 class="sm:col-span-2 text-sm font-bold text-slate-500 uppercase tracking-wide">Mother's
                                Details</h3>
                            <div class="input-group"><label>Name</label><input type="text" name="mother_name"></div>
                            <div class="input-group"><label>Mobile</label><input type="tel" name="mother_mobile"></div>
                            <div class="input-group"><label>Occupation</label><input type="text"
                                    name="mother_occupation"></div>
                            <div class="input-group"><label>Email</label><input type="email" name="mother_email"></div>
                        </div>

                        <div class="input-group w-full max-w-md">
                            <label>Annual Family Income</label>
                            <select name="annual_income">
                                <option value="">Select Range</option>
                                <option value="Below 2.5 LPA">Below 2.5 LPA</option>
                                <option value="2.5 - 5 LPA">2.5 - 5 LPA</option>
                                <option value="5 - 10 LPA">5 - 10 LPA</option>
                                <option value="Above 10 LPA">Above 10 LPA</option>
                            </select>
                        </div>

                        <div class="pt-2 flex justify-end">
                            <button type="submit"
                                class="bg-primary-600 text-white px-6 py-2.5 rounded-lg font-medium hover:bg-primary-700 transition shadow-lg shadow-primary-500/30">Save
                                Family Info</button>
                        </div>
                    </form>
                </div>

                <!-- Career Goals -->
                <div id="tab-career" class="tab-content p-8 hidden">
                    <h2 class="text-2xl font-bold text-slate-800 mb-6">Career Aspirations</h2>
                    <form id="form-career" onsubmit="saveSection(event, 'aspirations')"
                        class="grid sm:grid-cols-2 gap-6">
                        <div class="input-group">
                            <label>Dream Companies</label>
                            <input type="text" name="dream_company" placeholder="e.g. Google, Apple">
                        </div>
                        <div class="input-group">
                            <label>Preferred Roles</label>
                            <input type="text" name="preferred_roles" placeholder="Backend Dev, DevOps">
                        </div>
                        <div class="input-group">
                            <label>Expected CTC (LPA)</label>
                            <input type="number" step="0.5" name="expected_package" placeholder="e.g. 10">
                        </div>
                        <div class="input-group">
                            <label>Preferred Locations</label>
                            <input type="text" name="preferred_locations">
                        </div>
                        <div class="input-group">
                            <label>Willing to Relocate?</label>
                            <select name="willing_to_relocate">
                                <option value="true">Yes</option>
                                <option value="false">No</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Higher Studies?</label>
                            <select name="higher_studies">
                                <option value="No">No Plans</option>
                                <option value="MS Abroad">MS Abroad</option>
                                <option value="MBA">MBA</option>
                                <option value="GATE/MTech">GATE/MTech</option>
                            </select>
                        </div>
                        <div class="input-group sm:col-span-2">
                            <label>Career Objective / Summary</label>
                            <textarea name="career_goals" rows="4"
                                placeholder="Briefly describe your career goals..."></textarea>
                        </div>

                        <div class="sm:col-span-2 pt-2 flex justify-end">
                            <button type="submit"
                                class="bg-primary-600 text-white px-6 py-2.5 rounded-lg font-medium hover:bg-primary-700 transition shadow-lg shadow-primary-500/30">Save
                                Career Goals</button>
                        </div>
                    </form>
                </div>

                <!-- Skills -->
                <div id="tab-skills" class="tab-content p-8 hidden">
                    <h2 class="text-2xl font-bold text-slate-800 mb-2">Technical Proficiency</h2>
                    <p class="text-slate-500 text-sm mb-6">Rate yourself on a scale of 1-5.</p>
                    <form id="form-skills" onsubmit="saveSection(event, 'skills')">
                        <div id="skills-container" class="grid sm:grid-cols-2 gap-x-8 gap-y-4">
                            <!-- Dynamic -->
                            <div class="text-center col-span-2 text-slate-400 py-10">Loading Skills...</div>
                        </div>
                        <div class="pt-6 flex justify-end">
                            <button type="submit"
                                class="bg-primary-600 text-white px-6 py-2.5 rounded-lg font-medium hover:bg-primary-700 transition shadow-lg shadow-primary-500/30">Save
                                Skills</button>
                        </div>
                    </form>
                </div>

            </div>

            <!-- Complete Profile Action -->
            <div id="submit-section"
                class="mt-8 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-xl p-6 text-white shadow-lg hidden">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-xl font-bold">Profile Ready?</h3>
                        <p class="text-emerald-50 text-sm mt-1">Submit your profile to make it visible to
                            administrators.</p>
                    </div>
                    <button onclick="submitProfile()"
                        class="bg-white text-emerald-600 font-bold py-3 px-6 rounded-lg shadow-sm hover:bg-emerald-50 transition-colors">Submit
                        Profile</button>
                </div>
            </div>

        </div>
    </main>

    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // State
        let profileData = {};
        let skillsList = [];

        document.addEventListener('DOMContentLoaded', async () => {
            if (!requireAuth('student')) return;
            await Promise.all([loadProfile(), loadSkills(), loadBatches()]);
            document.getElementById('loading-overlay').classList.add('hidden');
        });

        // --- Navigation ---
        window.showTab = function (tabName) {
            // Update buttons
            document.querySelectorAll('.nav-item').forEach(btn => {
                if (btn.dataset.tab === tabName) btn.classList.add('active', 'bg-slate-50', 'text-primary-600');
                else btn.classList.remove('active', 'bg-slate-50', 'text-primary-600');
            });
            // Update content
            document.querySelectorAll('.tab-content').forEach(div => {
                if (div.id === `tab-${tabName}`) div.classList.remove('hidden');
                else div.classList.add('hidden');
            });
            // Mobile formatting if needed
        }

        // --- Data Loading ---
        async function loadProfile() {
            try {
                const data = await api.get('/api/student/profile');
                profileData = data.profile || {};
                populateUI();
            } catch (err) { console.error(err); }
        }

        async function loadSkills() {
            try {
                const data = await api.get('/api/skills');
                skillsList = data.skills || [];
                renderSkills();
            } catch (err) { console.error(err); }
        }

        async function loadBatches() {
            try {
                const data = await api.get('/api/batches');
                const sel = document.getElementById('select-batch');
                (data.batches || []).forEach(b => sel.appendChild(new Option(b.year, b.year)));
            } catch (err) { console.error(err); }
        }

        // --- UI Population ---
        function populateUI() {
            const s = profileData.student || {};
            const p = profileData.personal || {};
            const f = profileData.family || {};
            const a = profileData.academics || {};
            const ach = profileData.achievements || {};
            const asp = profileData.aspirations || {};

            // Header & Sidebar
            document.getElementById('profile-name').textContent = s.name || 'Student';
            document.getElementById('header-name').textContent = s.name || 'Student';
            document.getElementById('profile-email').textContent = s.official_email || '';
            document.getElementById('display-roll').textContent = s.roll_no || '---';
            document.getElementById('header-roll').textContent = s.roll_no || '';

            const avatarUrl = s.photo_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(s.name || 'S')}&background=6366f1&color=fff&size=128`;
            document.getElementById('profile-avatar').src = avatarUrl;
            document.getElementById('header-avatar').src = avatarUrl;

            document.getElementById('badge-batch').textContent = s.batch_year ? `Batch ${s.batch_year}` : 'No Batch';
            const statusMap = { 'not_placed': 'Unplaced', 'placed': 'Placed', 'opted_out': 'Opted Out' };
            document.getElementById('badge-status').textContent = statusMap[s.placement_status] || 'Unplaced';

            // Progress
            const progress = s.profile_completion || 0;
            document.getElementById('progress-percent').textContent = `${progress}%`;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            if (progress === 100) document.getElementById('submit-section').classList.remove('hidden');

            // Forms - MAPPING LOGIC (Preserving original logic)
            setForm('form-personal', {
                name: s.name, roll_no: s.roll_no, email: s.official_email,
                batch_year: s.batch_year,
                personal_email: p.personal_email, mobile_number: p.mobile_number, alt_mobile_number: p.alternate_mobile,
                date_of_birth: p.date_of_birth, gender: p.gender, aadhaar_no: p.aadhaar_number,
                linkedin_url: p.linkedin_url, github_url: p.github_url, portfolio_url: p.portfolio_url,
                address: p.address, city: p.city, pincode: p.pincode, residence_type: p.residence_type
            });

            setForm('form-family', {
                father_name: f.father_name, father_mobile: f.father_mobile, father_occupation: f.father_occupation, father_company_details: f.father_company,
                mother_name: f.mother_name, mother_mobile: f.mother_mobile, mother_occupation: f.mother_occupation, mother_email: f.mother_email,
                annual_income: f.father_annual_income
            });

            setForm('form-academics', {
                tenth_board: a.tenth_board, tenth_percentage: a.tenth_percentage, tenth_year: a.tenth_year,
                twelfth_board: a.twelfth_board, twelfth_percentage: a.twelfth_percentage, twelfth_year: a.twelfth_year,
                cgpa_sem1: a.cgpa_sem1, cgpa_sem2: a.cgpa_sem2, cgpa_sem3: a.cgpa_sem3, cgpa_sem4: a.cgpa_sem4,
                cgpa_sem5: a.cgpa_sem5, cgpa_sem6: a.cgpa_sem6, cgpa_sem7: a.cgpa_sem7, cgpa_sem8: a.cgpa_sem8,
                cgpa_overall: a.cgpa_overall, current_backlogs: a.current_backlogs, has_backlog_history: a.history_of_backlogs ? 'true' : 'false'
            });

            setForm('form-achievements', {
                certifications: ach.certifications, awards: ach.awards, workshops: ach.workshops,
                internships: ach.internships, projects: ach.projects, extra_curriculars: ach.extracurriculars
            });

            setForm('form-career', {
                dream_company: asp.dream_companies, preferred_roles: asp.preferred_roles,
                expected_package: asp.expected_salary, preferred_locations: asp.preferred_locations,
                higher_studies: asp.higher_studies, career_goals: asp.career_objective,
                willing_to_relocate: asp.willing_to_relocate ? 'true' : 'false'
            });

            // Populate Checkboxes/Skills
            const mySkills = profileData.skills || [];
            document.querySelectorAll('input[name^="skill_"]').forEach(inp => {
                const skillId = parseInt(inp.name.split('_')[1]);
                const skill = mySkills.find(s => s.skill_id === skillId);
                if (skill) inp.value = skill.proficiency_level;
            });
        }

        function setForm(formId, data) {
            const form = document.getElementById(formId);
            if (!form) return;
            Object.keys(data).forEach(key => {
                const field = form.elements[key];
                if (field) field.value = data[key] || '';
            });
        }

        function renderSkills() {
            const container = document.getElementById('skills-container');
            container.innerHTML = skillsList.map(skill => {
                // Check existing proficiency
                const mySkills = profileData.skills || [];
                const existing = mySkills.find(s => s.skill_id === skill.id);
                const val = existing ? existing.proficiency_level : 0;

                return `
                    <div class="flex items-center justify-between p-3 border border-slate-100 rounded-lg bg-slate-50">
                        <label class="font-medium text-slate-700 text-sm">${skill.name}</label>
                        <div class="flex items-center gap-2">
                             <input type="range" name="skill_${skill.id}" min="0" max="5" value="${val}" class="w-24 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-primary-600" oninput="this.nextElementSibling.textContent = this.value > 0 ? this.value + '/5' : 'None'">
                             <span class="text-xs font-mono w-8 text-right text-slate-500">${val > 0 ? val + '/5' : 'None'}</span>
                        </div>
                    </div>
                 `;
            }).join('');
        }

        // --- Actions ---
        async function saveSection(e, section) {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            const payload = Object.fromEntries(formData.entries());

            // Special Handling (Skills need array)
            if (section === 'skills') {
                const skills = [];
                for (let [key, val] of Object.entries(payload)) {
                    if (key.startsWith('skill_') && parseInt(val) > 0) {
                        skills.push({ skill_id: parseInt(key.split('_')[1]), proficiency_level: parseInt(val) });
                    }
                }
                payload.skills = skills;
            }

            // Numeric format fixes
            ['cgpa_overall', 'tenth_percentage', 'twelfth_percentage', 'expected_package'].forEach(k => {
                if (payload[k]) payload[k] = parseFloat(payload[k]);
            });
            ['current_backlogs', 'tenth_year', 'twelfth_year'].forEach(k => {
                if (payload[k]) payload[k] = parseInt(payload[k]);
            });

            try {
                await api.put(`/api/student/profile/${section}`, payload);
                utils.showToast(section.charAt(0).toUpperCase() + section.slice(1) + ' saved successfully', 'success');
                loadProfile(); // Refresh for progress update
            } catch (err) {
                console.error(err);
                utils.showToast('Failed to save changes', 'error');
            }
        }

        async function uploadPhoto(input) {
            if (!input.files || !input.files[0]) return;
            const formData = new FormData();
            formData.append('photo', input.files[0]);

            try {
                await fetch(`${API_BASE_URL}/api/student/profile/photo`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` },
                    body: formData
                });
                utils.showToast('Photo uploaded', 'success');
                loadProfile();
            } catch (e) { utils.showToast('Photo upload failed', 'error'); }
        }

        async function submitProfile() {
            if (!confirm('Are you sure you want to submit your profile? This confirms all details are accurate.')) return;
            // Logic for 'submission' (could be a status update or just a toast if no endpoint)
            utils.showToast('Profile submitted successfully!', 'success');
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user_role');
            window.location.href = 'index.html';
        }
    </script>
</body>

</html>